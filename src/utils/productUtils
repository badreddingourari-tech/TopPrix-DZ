// Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ùˆimport { OuedknissService } from './ouedknissService.js';

export async function smartProductSearch(productName, intent) {
    try {
        console.log(`ğŸ›ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù†: ${productName}`);

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ouedkniss (Ø­Ù‚ÙŠÙ‚ÙŠ)
        const ouedknissResults = await OuedknissService.searchProducts(productName);

        if (ouedknissResults.length > 0) {
            return formatOuedknissResults(ouedknissResults, productName);
        }

        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­Ù‚ÙŠÙ‚ÙŠØ©
        return `ğŸ” Ù„Ù… Ø£Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù€ "${productName}" ÙÙŠ Ouedkniss Ø­Ø§Ù„ÙŠØ§Ù‹.\n\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±Ø©:\nhttps://www.ouedkniss.com/resultat/?text=${encodeURIComponent(productName)}`;

    } catch (error) {
        console.error("Search error:", error);
        return `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${productName}". Ø¬Ø±Ø¨ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø£Ùˆ Ø§Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ouedkniss.`;
    }
}

function formatOuedknissResults(results, productName) {
    let message = `ğŸ›ï¸ *Ù†ØªØ§Ø¦Ø¬ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ouedkniss Ù„Ù€ ${productName}*\n\n`;

    results.forEach((product, index) => {
        message += `*${index + 1}. ${product.title}*\n`;
        message += `ğŸ’µ ${product.price}\n`;
        message += `ğŸ“ ${product.location}\n`;
        if (product.link) {
            message += `ğŸ”— [Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬](${product.link})\n`;
        }
        message += `\n`;
    });

    message += `---\n`;
    message += `ğŸ” *Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±:* https://www.ouedkniss.com/resultat/?text=${encodeURIComponent(productName)}`;

    return message;
}Ø§Ù„Ø¨Ø­Ø«
export async function smartProductSearch(productName, intent) {
    try {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ APIs
        const mockResults = [
            { name: "Ø³ÙƒØ±", price: "180 Ø¯Ø¬", market: "ÙÙŠØ³ÙŠØ±Ùƒ" },
            { name: "Ù‚Ù‡ÙˆØ©", price: "450 Ø¯Ø¬", market: "Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù…" },
            { name: "Ø²ÙŠØª", price: "320 Ø¯Ø¬", market: "ÙÙŠØ³ÙŠØ±Ùƒ" }
        ];

        const foundProduct = mockResults.find(p => 
            productName.includes(p.name.toLowerCase())
        );

        if (foundProduct) {
            return `ğŸ›ï¸ *${foundProduct.name}*
ğŸ’µ Ø§Ù„Ø³Ø¹Ø±: ${foundProduct.price}
ğŸª Ø§Ù„Ù…ØªØ¬Ø±: ${foundProduct.market}

ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ: https://fisec.com`;
        } else {
            return `Ù„Ù… Ø£Ø¬Ø¯ "${productName}" ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±Ø©:
https://fisec.com/search?q=${encodeURIComponent(productName)}`;
        }
    } catch (error) {
        console.error("Search error:", error);
        return "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹";
    }
}
